import { cloneElement } from 'react'
import { Grid, Row, Col } from '@smooth-ui/core-em'
export { default as theme } from './theme'
import GridLayout from './components/GridLayout'
import Iframe from './components/Iframe'
import Exercise from './components/Exercise'
import Title from './components/Title'
import StepShow from './components/StepShow'
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import {
  faGithub,
  faTwitter,
  faFacebook,
  faInstagram,
} from '@fortawesome/free-brands-svg-icons'
import {
  faLightbulb,
  faMobileAlt,
  faCubes,
  faFish,
} from '@fortawesome/free-solid-svg-icons'
import Timeline from './components/Timeline'
import ImageGallery from './images/egghead/ImageGallery.png'
import ManageReactForm from './images/egghead/ManageReactForm.png'
import Mobx from './images/egghead/Mobx.png'
import OptimisticReact from './images/egghead/OptimisticReact.png'
import ReactAdvPatterns from './images/egghead/ReactAdvPatterns.png'
import ReactBeginners from './images/egghead/ReactBeginners.png'
import ReactContext from './images/egghead/ReactContext.png'
import ReactCook from './images/egghead/ReactCook.png'
import ReactDndFinal from './images/egghead/ReactDndFinal.png'
import ReactHooks from './images/egghead/ReactHooks.png'
import ReactMobileNav from './images/egghead/ReactMobileNav.png'
import ReactRecompose from './images/egghead/ReactRecompose.png'
import ReactStart from './images/egghead/ReactStart.png'
import ReactStorybook from './images/egghead/ReactStorybook.png'
import Redux from './images/egghead/Redux.png'
import ReduxStateADT from './images/egghead/ReduxStateADT.png'
import SimplifyHooks from './images/egghead/SimplifyHooks.png'
import TestReactJest from './images/egghead/TestReactJest.png'
import funcExplain from './images/func-explain.jpg'
import contextPic from './images/context.png'

<img
  src="https://res.cloudinary.com/smooth/image/upload/w_300,dpr_2/v1552399812/logos/smooth-academy.svg"
  alt="Smooth Academy"
  style={{ width: '50%' }}
/>

<h1>React Advanced<br />Workshop</h1>

---

<img
  src="https://res.cloudinary.com/smooth/image/upload/w_300,h_300,dpr_2/v1551174170/avatars/greg-berge.jpg"
  alt="Greg Berg√©"
  style={{ width: '50%', maxWidth: 300, borderRadius: '50%' }}
/>

### Greg Berg√©

D√©veloppeur full-stack JavaScript.<br />
Co-fondateur de Smooth Code

<div>
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faGithub} /> @neoziro
  </a>
  {' | '}
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faTwitter} /> @neoziro
  </a>
</div>

---

## Sommaire

<Grid fluid>
  <Row>
    <Col>
      <ul>
        <li>State of React</li>
        <li>Terms</li>
        <li>Primitives</li>
        <li>Lifecycle</li>
        <li>Start with React</li>
        <li>Hooks</li>
        <li>Rules of Hooks</li>
        <li>State Management</li>
        <li>Controlled Components</li>
        <li>Effects</li>
      </ul>
    </Col>
    <Col>
      <ul>
        <li>Custom Hooks</li>
        <li>Error Boundaries</li>
        <li>Limit of Boundaries</li>
        <li>Render props</li>
        <li>Advanced State Management</li>
        <li>Scalable Components</li>
        <li>Context</li>
        <li>Avoid Redux</li>
        <li>DOM Interactions</li>
        <li>Effects in depth</li>
      </ul>
    </Col>
  </Row>
</Grid>

---

<Title>
  <Title.Picture src={ReactBeginners} />
  <Title.Text>State of React</Title.Text>
</Title>

---

## Historique

<Timeline>
  <StepShow
    renderHidden={child => cloneElement(child, { style: { opacity: 0 } })}
  >
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faLightbulb} />
      </Timeline.Icon>
      <Timeline.Date>2010</Timeline.Date>
      <Timeline.Title>Jordan Walke cr√©e React (Reason)</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faInstagram} />
      </Timeline.Icon>
      <Timeline.Date>2012</Timeline.Date>
      <Timeline.Title>Instagram acquired by Facebook</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faCubes} />
      </Timeline.Icon>
      <Timeline.Date>2013</Timeline.Date>
      <Timeline.Title>React Open Source</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faMobileAlt} />
      </Timeline.Icon>
      <Timeline.Date>2015</Timeline.Date>
      <Timeline.Title>React Native Open Source</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faCubes} />
      </Timeline.Icon>
      <Timeline.Date>2017</Timeline.Date>
      <Timeline.Title>React Fiber</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faFish} />
      </Timeline.Icon>
      <Timeline.Date>2019</Timeline.Date>
      <Timeline.Title>React Hooks</Timeline.Title>
    </Timeline.Event>
  </StepShow>
</Timeline>

---

## React vs Vue vs Angular

<Iframe src="https://npmcharts.com/compare/react,@angular/core,vue?minimal=true&interval=7" />

---

## √Ä retenir

> üëâ React est incontournable

> üëâ Vue est en croissance

> üëâ Angular est sur le d√©clin

---

<Title>
  <Title.Picture src={ReactStorybook} />
  <Title.Text>Terms</Title.Text>
</Title>

---

## Fiber ?

- R√©√©criture du coeur de React (v16)
- Permet la cr√©ation de nouvelles features
- Hooks, Suspense, Concurrent Mode...

> üëâ Aucun impact pour le d√©veloppeur

---

## Hooks ?

- Nouvelle API de cr√©ation de composants
- Sortie le 6 f√©vrier 2019 (v16.8)

> üëâ Simplification du d√©veloppement

---

## Concurrent Mode ?

- Rendu non bloquant
- Permet d'optimiser les performances
- Mode strict requis
- Sortie √† venir (Q2 2019)

> üëâ Application plus fluide et performante

---

## Suspense ?

- Solution pour g√©rer le data-fetching
- Sortie √† venir (mid 2019)

> üëâ Data-fetching simplifi√©

---

## SSR ?

- Server Side Rendering
- Aussi appel√© "Universal Web App"
- Le HTML est g√©n√©r√© c√¥t√© serveur
- Inverse de CSR (Client Side Rendering)

> üëâ Le seul use-case est le SEO

---

## Progressive Web App ?

- Application qui fonctionne en offline

> üëâ C'est un must-have, rarement requis

---

<Title>
  <Title.Picture src={ReactCook} />
  <Title.Text>Primitives</Title.Text>
</Title>

---

## JSX

```js
<div className="foo" />
```

> üëâ Extension au langage JavaScript

---

## Element

```js
const element = <div />
```

> üëâ Une instance de composant React

---

## Composant

```js
function Div(props) {
  return <div />
}
```

`props => element`

> üëâ Majuscule obligatoire !

---

## Qu'est-ce qu'une fonction ?

<img style={{ maxHeight: '80vh', width: '80%' }} src={funcExplain} />

---

export default GridLayout

## Syntaxe des fonctions

```js
// Named function
function fn(props) {
  return props.foo
}
```

```js
// Named function + destructuring
function fn({ foo }) {
  return foo
}
```

```js
// Arrow function
const fn = props => {
  return props.foo
}
```

```js
// Arrow function + destructuring
const fn = ({ foo }) => {
  return foo
}
```

```js
// Short Arrow function + destructuring
const fn = props => props.foo
```

```js
// Short Arrow function + destructuring
const fn = ({ foo }) => foo
```

---

## √Ä retenir

> üëâ JSX : extension de JavaScript

> üëâ Element : morceau de JSX

> üëâ Composant : fonction qui renvoie un √©l√©ment

---

<Title>
  <Title.Picture src={ImageGallery} />
  <Title.Text>Lifecycle</Title.Text>
</Title>

---

## Phases

- Mount
- Update
- Unmount

---

## Mount

- Le composant est ajout√© dans l'arbre React

---

## Update

- Le composant est mis √† jour
- D√©clench√© par au-dessus (les props)
- Ou par lui-m√™me (le state)

---

## Unmount

- Le composant est retir√© de l'arbre React

---

## Diagramme interactif

<Iframe src="https://react-lifecycle.netlify.com" />

---

## √Ä retenir

> üëâ Trois phases : Mount, Update, Unmount

> üëâ Le rendu est d√©clench√© lors du Mount et de l'Update

---

<Title>
  <Title.Picture src={ReactStart} />
  <Title.Text>Start with React</Title.Text>
</Title>

---

## Create React App

- Moyen le plus rapide pour d√©marrer
- Maintenu par la team React
- SVGR inside ‚ú®üòé

---

## Philosophie

- Zero-config
- Focus sur React
- Scalable (√©jection possible)

---

## Under the hood

- üì¶ Bundler (webpack)
- üåé Dev server (webpack)
- ü§Ø Transpiler (Babel)
- üëÆ‚Äç‚ôÇÔ∏è Linter (ESLint)
- ‚ú® CSS Autoprefixer
- üÉè Test runner (Jest)
- ü¶Å Gestion des SVG (SVGR)

---

## √Ä retenir

> üëâ Projet React ‚Üí create-react-app

---

<Exercise num={1} title="Create React App" />

---

<Title>
  <Title.Picture src={SimplifyHooks} />
  <Title.Text>Hooks</Title.Text>
</Title>

---

## Introduction

<iframe
  style={{ width: '80vw', height: '50vh', overflow: 'hidden' }}
  src="https://www.youtube.com/embed/dpw9EHDh2bM"
  frameborder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
/>

Pr√©sent√© par Dan Abramov et Sophie Alpert lors de la React Conf 2018.

---

## No breaking change !

- Les classes restent support√©es
- Tout est 100% r√©trocompatible
- Pas impos√©, mais recommand√© üòè

---

## Motivation

- Partage de logique entre composants
- Alternatives aux HOCs et aux render props
- API plus simple √† appr√©hender

---

## √Ä retenir

> üëâ Migrer son code progressivement ü§ó

> üëâ Ne pas se forcer √† les utiliser ü§Ø

---

## Qu'est-ce qu‚Äôun Hook üé£ ?

<dl>
  <dt>React Hook</dt>
  <dd>
    <em>/…πiÀêÀà√¶kt/ /h äk/</em> ‚Ä¢ Fonction sp√©ciale permettant de se brancher sur
    des features React √† l'int√©rieur d'un composant.
  </dd>
</dl>

---

## Hooks basics üòá

- `useState`
- `useEffect`
- `useContext`

---

## Hooks avanc√©s üòà

- `useReducer`
- `useCallBack`
- `useMemo`
- `useRef`
- `useImperativeHandle`
- `useLayoutEffect`
- `useDebugValue`

---

<Title>
  <Title.Picture src={ReactMobileNav} />
  <Title.Text>Rules of Hooks</Title.Text>
</Title>

---

<h2>Uniquement dans les fonctions,<br />tu les utiliseras.</h2>

```js
function Example(props) {
  // ‚úÖ Vous pouvez utiliser les hooks ici
  return <div />
}
```

> Pas de Hooks dans les classes.

---

<h2>Au niveau le plus haut,<br />tu te positionneras.</h2>

```js
function Example(props) {
  if (props.disabled) {
    // üö´ Vous ne pouvez pas utiliser les hooks ici
  }
  return <div />
}
```

> Pas de conditions, boucles ou autre...

---

<Title>
  <Title.Picture src={ReactRecompose} />
  <Title.Text>State Management</Title.Text>
</Title>

---

## Hook Counter

```js
import React, { useState } from 'react'

function Example() {
  // "count" est le state, "setCount" est la fonction permettant de modifier le state
  // "0" est la valeur initiale
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## Class Counter

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Le state n‚Äôest pas merg√©

```js
const [coords, setCoords] = useState({ x: 10, y: 20 })
setCoords({ x: 15 })
// Les nouvelles coordonn√©es seront { x: 15 } et pas { x: 10, y: 15 }
```

---

## D√©clarer plusieurs √©tats

```js
function ExampleWithManyStates() {
  // D√©clarer plusieurs state dans la m√™me fonction !
  const [age, setAge] = useState(42)
  const [fruit, setFruit] = useState('banana')
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }])
  // ...
}
```

> üëâ Ne pas h√©siter √† d√©composer les states

---

## Comment √ßa marche ?

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

- `count` est √† 0 au montage
- Au clic sur le bouton, le state est mis √† jour
- Le composant est re-rendu, `count` est √† 1

---

## Update

```js
const [count, setCount] = useState(0)
// On peut passer une valeur directement
setCount(10)
// Si on utilise le state pr√©c√©dent, on passe une fonction
setCount(previousCount => previousCount + 1)
```

> üëâ Toujours utiliser une fonction si on part du state pr√©c√©dent

---

<Title>
  <Title.Picture src={ManageReactForm} />
  <Title.Text>Controlled Components</Title.Text>
</Title>

---

## Uncontrolled components

```js
function Example() {
  // Input non contr√¥l√©, il g√®re son state seul
  return <input defaultValue="initial value" />
}
```

---

## Controlled components

```js
function Example() {
  const [value, setValue] = useState('')
  // Input contr√¥l√©, le state est hors du composant "input"
  return (
    <input value={value} onChange={event => setValue(event.target.value)} />
  )
}
```

---

## Controlled to Uncontrolled

```js
function ControlledInput({ defaultValue, ...props }) {
  const [value, setValue] = useState(defaultValue)
  return (
    <input
      value={value}
      onChange={event => setValue(event.target.value)}
      {...props}
    />
  )
}
```

> üëâ Il est possible de cr√©er un composant non-contr√¥l√© √† partir d'un composant contr√¥l√©, mais pas l'inverse.

---

## √Ä retenir

> üëâ Toujours privil√©gier les composants contr√¥l√©s üëÆ‚Äç‚ôÇÔ∏è

---

<Exercise num={2} title="Search Field" />

---

<Title>
  <Title.Picture src={OptimisticReact} />
  <Title.Text>Effects</Title.Text>
</Title>

---

# Qu'est-ce qu'un effet ‚ú® ?

---

<dl>
  <dt>Effet</dt>
  <dd>
    <em>\e.f…õ\</em> ‚Ä¢ Effet de bord sous forme de fonction d√©clench√© apr√®s le
    rendu du composant.
  </dd>
</dl>

---

## Page Title

```js
import React, { useState, useEffect } from 'react'
function Example() {
  const [count, setCount] = useState(0)

  // Similar to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = 'You clicked ' + count + ' times'
  })

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## √âquivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  componentDidMount() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  componentDidUpdate() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Penser "effect"

- Quel est l‚Äôeffet de bord ?
- Comment dois-je le nettoyer ?
- Qu‚Äôest-ce qui impacte cet effet ?

---

## Nettoyage

```js
function ClickSpy() {
  useEffect(() => {
    function handleClick() {
      alert('clicked')
    }
    document.addEventListener('click', handleClick)
    // La fonction retourn√©e par l'effet est le "clean"
    return () => {
      document.removeEventListener('click', handleClick)
    }
  })

  return null
}
```

---

## Lifecycle

- Mount
  - Run effect
- Update
  - Clean effect
  - Run effect
- Unmount
  - Clean effect

---

## S√©paration des responsabilit√©s

```js
useEffect(() => {
  document.title = 'My title'
})
useEffect(() => {
  pingMyApi()
})
```

> üëâ Un effet ‚Üí Une responsabilit√©

---

## D√©pendances

```js
function PageTitle({ title }) {
  useEffect(() => {
    document.title = title
  }, [title]) // Cet effet sera d√©clench√© que si "title" change
  return null
}
```

> üëâ Les d√©pendances sont les variables externes utilis√©es dans l'effet

---

## Montage uniquement

```js
function MountSpy() {
  useEffect(() => {
    console.log('Mount')
  }, [])
  return null
}
```

> üëâ Pas de d√©pendances, donc uniquement au montage !

---

<Exercise num={3} title="Data Fetching" />

---

<Title>
  <Title.Picture src={ReactHooks} />
  <Title.Text>Custom Hooks</Title.Text>
</Title>

---

## Composition de Hooks

```js
function App() {
  const [query, setQuery] = useState('Lord of the Rings')
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: {
          api_key: 'c5742978852b8f695a61e22a33a8196c',
          query,
        },
      })
      .then(res => {
        setMovies(res.data.results)
      })
  }, [query])

  /* ... */
}
```

---

## Extraire notre Hook

```js
function useMovieSearch(query) {
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: {
          api_key: 'c5742978852b8f695a61e22a33a8196c',
          query,
        },
      })
      .then(res => {
        setMovies(res.data.results)
      })
  }, [query])

  return movies
}
```

---

## Rules of Hooks

- Tous les hooks doivent √™tre au premier niveau
- Un custom hook est pr√©fix√© par `use`
- Une seule reponsabilit√© par Hook

---

<Exercise num={4} title="Custom Hooks" />

---

<Title>
  <Title.Picture src={ReduxStateADT} />
  <Title.Text>Error Boundaries</Title.Text>
</Title>

---

## Utilisation

```js
<ErrorBoundary>
  <MyWidget />
</ErrorBoundary>
```

> üëâ Comparable √† un try / catch

---

## Impl√©mentation

```js
import React, { Component } from 'react'

export default class Catch extends Component {
  // Cr√©ation du state initial
  state = { hasError: false }

  static getDerivedStateFromError(error) {
    // Mise √† jour du state, au prochain rendu, nous saurons qu'une erreur a √©t√© catch√©e
    return { hasError: true }
  }

  render() {
    if (this.state.hasError) {
      // Affichage du fallback de notre choix
      return <h1>Something went wrong.</h1>
    }

    return this.props.children
  }
}
```

---

## √Ä retenir

> üëâ Mettre des boundaries aux endroits strat√©giques

---

<Exercise num={5} title="Error Handling" />

---

<Title>
  <Title.Picture src={ReduxStateADT} />
  <Title.Text>Limits of Boundaries</Title.Text>
</Title>

---

## Prenons un Hook

```js
function useCounter() {
  const [count, setCount] = useState(0)

  useEffect(() => {
    const interval = setInterval(() => setCount(count => count + 1), 1000)
    return () => clearInterval(interval)
  }, [])

  return count
}
```

---

## Dans un composant...

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Que se passe-t-il ?

- A chaque tick de l'interval, `setCount` est appel√©
- Un nouveau state est g√©n√©r√©
- Le composant `Example` est re-rendu

---

## Pauvre `OtherStuff`, il n'a rien demand√© !

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      {/* OtherStuff va √™tre re-rendu pourtant il n‚Äôutilise pas le compteur */}
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Et si `useCounter` √©met une erreur ?

- L‚Äôerreur est √©mise par le composant qui contient le Hook
- `Example` est donc l'√©metteur de l‚Äôerreur

---

# Comment localiser une logique ?

---

<Title>
  <Title.Picture src={ReactAdvPatterns} />
  <Title.Text>Render props</Title.Text>
</Title>

---

## Impl√©mentation

```js
function Counter({ children }) {
  const count = useCounter()
  // `children` est habituellement un ou plusieurs √©l√©ment
  // ici ce sera une fonction, la "render prop" !
  return children(count)
}
```

---

## Utilisation

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* On passe une fonction en `children` */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## Ce qui a chang√©

```js
function Example() {
  return (
    <div>
      {/* Example, ne se re-rend plus, OtherStuff n'est donc pas re-rendu */}
      <OtherStuff />
      {/* Le compteur se re-rend et appelle la fonction "children" */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## I believe I can catch!

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* Je peux placer une Error Boundary autour de mon composant "Counter" */}
      <Catch>
        <Counter>{count => <div>{count}</div>}</Counter>
      </Catch>
    </div>
  )
}
```

---

## √Ä retenir

> üëâ Les hooks ne remplacent pas les render props

> üëâ Les render props permettent une isolation du rendu

> üëâ Elle permettent une gestion fine des erreurs

---

<Exercise num={6} title="Render props" />

---

<Title>
  <Title.Picture src={ReactRecompose} />
  <Title.Text>Advanced State Management</Title.Text>
</Title>

---

## La gestion du state, c‚Äôest compliqu√©

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <button onClick={() => setCount(count => count + 1)}>Increment</button>
      <button onClick={() => setCount(count => count - 1)}>Decrement</button>
    </div>
  )
}
```

La logique est interne au composant, c'est mal üôÑ.

---

# `useReducer` √† la rescousse !

<iframe
  src="https://giphy.com/embed/l0HlTPnnfzRsf4f2U"
  width="480"
  height="270"
  frameBorder="0"
  allowFullScreen
/>

---

## M√™me exemple avec `useReducer`

```js
// Le reducer est une simple fonction testable
function reducer(count, action) {
  switch (action.type) {
    case 'increment':
      return count + 1
    case 'decrement':
      return count - 1
    default:
      throw new Error('Unsupported action')
  }
}

function Example() {
  const [count, dispatch] = useReducer(reducer)

  // Le composant se contente d'√©mettre des actions
  return (
    <div>
      <button onClick={() => dispatch({ type: 'increment' })}>Increment</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>Decrement</button>
    </div>
  )
}
```

---

## √Ä retenir

> üëâ Gestion du state centralis√©e

> üëâ Le reducer est testable

> üëâ Le code des composants est plus clair

---

<Exercise num={7} title="Advanced State" />

---

<Title>
  <Title.Picture src={ReactDndFinal} />
  <Title.Text>Scalable Components</Title.Text>
</Title>

---

## Styled Components

<Iframe src="https://codesandbox.io/embed/2vpm40qk90?autoresize=1&fontsize=14&hidenavigation=1" />

---

## Styled Components

- Le style fait parti du composant
- Le style change en fonction des props
- Du vrai CSS !

---

## Comment cr√©er un composant Card ?

---

import Card from './components/Card'

## Ce que je veux obtenir

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## Je cr√©e mon composant !

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      <CardHeader>{title}</CardHeader>
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

```js
<Card title="Hello!" text="I am Card" />
```

---

# √áa marche !

---

# A new product owner is coming!

<iframe
  src="https://giphy.com/embed/Cmr1OMJ2FN0B2"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# ‚ÄúTu peux enlever le titre ?‚Äù

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## ‚ÄúOK, pas de soucis !‚Äù

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      {title && <CardHeader>{title}</CardHeader>}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

# A UX designer is coming!

<iframe
  src="https://giphy.com/embed/3ornk57KwDXf81rjWM"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# ‚ÄúLe titre sur un fond vert est plus parlant.‚Äù

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## ‚ÄúOK, je pense que je peux le faire.‚Äù

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, titleBackgroundColor, text }) {
  return (
    <div>
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<h1>A new marketing manager<br/> appears!</h1>

<iframe
  src="https://giphy.com/embed/t98sHJAJ69MCoMoXAr"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# ‚ÄúTu peux mettre une barre de pub √† la place du header ?‚Äù

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    üëª -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## ‚ÄúEuh...‚Äù

```js
const CardHeader = styled.div``
const CardBody = styled.div``
const CardAd = styled.div``

function Card({ title, titleBackgroundColor, ad, text }) {
  return (
    <div>
      {ad && <CardAd>{ad}</CardAd>}
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<iframe
  src="https://giphy.com/embed/46itMIe0bkQeY"
  width="480"
  height="267"
  frameBorder="0"
  allowFullScreen
/>

---

# Et si on avait fait autrement ? ü§î

---

```js
export const Card = styled.div``
Card.Body = styled.div``
Card.Header = styled.div``
```

---

# Les choses auraient √©t√© bien diff√©rentes... üòå

---

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a card</Card.Body>
</Card>

```js
<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

```js
<Card>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

```js
<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>
```

---

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    üëª -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a card</Card.Body>
</Card>

```js
<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    üëª -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

## √Ä retenir

> üëâ Pensez aux "children"

> üëâ Un composant par √©l√©ment DOM

---

<Exercise num={8} title="Scalable Components" />

---

<Title>
  <Title.Picture src={ReactContext} />
  <Title.Text>Context</Title.Text>
</Title>

---

## Le contexte c'est quoi ?

<img src={contextPic} />

---

## Exemple

```js
import React, { createContext, useContext } from 'react'

// On cr√©e un `ThemeContext` avec pour valeur par d√©faut "white"
const ThemeContext = createContext('white')

function Button({ children }) {
  // On r√©cup√®re la valeur inject√©e dans le contexte avec `useContext`
  const theme = useContext(ThemeContext)
  return <button style={{ color: theme }}>{children}</button>
}

function App() {
  // Le `Context.Provider` permet d'injecter une valeur dans `ThemeContext`
  // Tous les enfants ont alors acc√®s √† cette valeur
  return (
    <ThemeContext.Provider value="black">
      <Button>Hello</Button>
    </ThemeContext.Provider>
  )
}
```

---

## Que se passe-t-il ?

- Le `Provider` subit un mount/update
- La valeur inject√©e est-elle diff√©rente ?
  - Oui ‚Üí les `Consumer` sont re-rendus
  - Non ‚Üí rien ne se passe

---

## Contexte riche

```js
function ThemeProvider({ color, font }) {
  // L'objet `value` est nouveau √† chaque rendu
  // `ThemeContext` notifie donc ses "consumers" √† chaque rendu
  const value = { color, font }
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## `useMemo`

```js
function ThemeProvider({ theme }) {
  // `useMemo` m√©morise le r√©sultat de la fonction tant que les d√©pendances ne changent pas
  // Tant que `theme` n'a pas chang√©, on aura le m√™me objet `value`
  const value = useMemo(() => ({ theme }), [theme])
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## Contexte dynamique

```js
function ThemeProvider({ defaultTheme, children }) {
  // Un `state` contient le `theme`
  const [theme, setTheme] = useState(defaultTheme)
  // On injecte la fonction `setTheme` dans le contexte
  const value = useMemo(() => ({ theme, setTheme }), [theme, setTheme])
  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
}

// in another file...

function ThemeSwitcher() {
  const { theme, setTheme } = useContext(ThemeContext)
  return (
    <button
      onClick={() => setTheme(theme => (theme === 'dark' ? 'light' : 'dark'))}
    >
      Switch theme {theme}
    </button>
  )
}
```

---

<Title>
  <Title.Picture src={Redux} />
  <Title.Text>Avoid Redux</Title.Text>
</Title>

---

## Qu'est-ce que Redux ?

- Communication entre les composants
- State modifi√© par un reducer
- Connect / Dispatch

---

## C'est d√©j√† dans React !

- `createContext`
- `useReducer`
- `useContext`

---

```js
// redux.js
import React, { createContext, useReducer, useContext } from 'react'

const ReduxContext = createContext()

export function ReduxProvider({ reducer, initialState, children }) {
  // On cr√© un reducer
  const [state, dispatch] = useReducer(reducer, initialState)
  // On injecte le state et la fonction dispatch
  const value = useMemo(() => ({ state, dispatch }), [state, dispatch])
  return <ReduxContext.Provider value={value}>{children}</ReduxContext.Provider>
}

export function useRedux() {
  return useContext(ReduxContext)
}

// App.js
import React from 'react'
import { ReduxProvider } from './redux'
import { reducer, initialState } from './reducer'

export default function App() {
  return (
    <ReduxProvider reducer={reducer} initialState={initialState}>
      <>
        {/* ... */}
        <RegisterButton />
      </>
    </ReduxProvider>
  )
}

// RegisterButton.js
import React from 'react'
import { useRedux } from './redux'

function RegisterButton() {
  const { dispatch } = useContext(ReduxContext)

  return (
    <button onClick={() => dispatch({ type: 'register' })}>Register</button>
  )
}
```

---

<Exercise num={9} title="Internationalization" />

---

<Title>
  <Title.Picture src={Mobx} />
  <Title.Text>DOM Interactions</Title.Text>
</Title>

---

## Component Refs

```js
function Example() {
  // `ref.current` sera la r√©f√©rence vers l'√©l√©ment une fois le composant mont√©
  const ref = useRef()
  return <input type="text" ref={ref} />
}
```

---

## Forward Ref

```js
const FancyInput = React.forwardRef((props, ref) => (
  <input ref={ref} className="FancyInput" />
))

function Example() {
  // `ref.current` sera la r√©f√©rence √† l'√©l√©ment DOM input
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

```js
const FancyInput = forwardRef((props, ref) => {
  const inputRef = useRef()

  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus()
    },
  }))

  return <input ref={inputRef} className="FancyInput" />
})

function Example() {
  // `ref.current.focus()` fonctionnera
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

- Permet de customiser l‚Äôinstance g√©n√©r√©e par `useRef`
- A n‚Äôutiliser qu‚Äôavec `forwardRef`

---

<Exercise num={10} title="Autofocus" />

---

<Title>
  <Title.Picture src={TestReactJest} />
  <Title.Text>Effects in depth</Title.Text>
</Title>

---

## `useEffect` ne marche pas !

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

> useEffect capture les variables au montage

---

## C'√©tait pareil avant

<iframe
  src="https://codesandbox.io/embed/w2wxl3yo0l?fontsize=14"
  style={{ width: '100%', height: 500, border: 0, overflow: 'hidden' }}
  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
/>

---

# Comment faire ?

---

# 1. Sp√©cifier les d√©pendances

---

## Avec d√©pendances

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

# 2. `useRef` √† la rescousse !

---

## Avec `useRef`

```js
function Example() {
  const [count, setCount] = useState(0)
  const countRef = useRef()
  countRef.current = count
  useEffect(() => {
    const interval = setInterval(() => console.log(countRef.current), 100)
    return () => clearInterval(interval)
  }, [countRef])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

## Qu'est-ce que le `useRef` ?

- Un objet unique √† votre instance de composant
- Un moyen de stocker des valeurs sans d√©clencher un update

---

## Utilisation

```js
const ref = useRef(/* initial value */)
ref.current // Access ref value using `ref.current`
```

---

<Exercise num={11} title="Keyboard Shortcuts" />

---

# Thanks!

> üòç J'ai aim√©, [je poste un avis](https://www.google.fr/maps/place/Smooth+Code/@48.8657415,2.3519553,17z/data=!3m1!4b1!4m5!3m4!1s0x47e66e1a846e6f39:0x3140a381af8bfb56!8m2!3d48.865738!4d2.354144?hl=en) !

> ü§≠ Je n'ai pas aim√©, je m'abstiens !
